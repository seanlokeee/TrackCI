version: 2.1

# collection of jobs which get executed as part of the workflow
jobs:
  build:
    docker:
      # use latest version of node in long term support
      - image: circleci/node:lts
    steps:
      - checkout # get code from source repository
      - run:
          name: Set up environment
          command: |
            cd src
            npm install

  #take output of the build, package it up and store it somewhere for future use
  package: 
    docker:
      - image: circleci/node:lts
    environment:
      NODE_ENV: production
    steps:
      - checkout
      #artifact generated by compiling the application/website
      - run: |
          cd src
          npm install
      #dist = distribution folder
      - run: |
          mkdir -p dist
          zip -r dist/src.zip src/
      - store_artifacts:
          path: dist

#describes which jobs get executed, in which order, and in which scenarios
workflows:
  version: 2
  build-test-package:
    jobs:
      - build
      #packaging must only run on the master branch
